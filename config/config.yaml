# DLFE-LSTM-WSI 主配置文件
project:
  name: "DLFE-LSTM-WSI"
  version: "1.0.0"
  seed: 42
  device: "cuda:0"
  log_dir: ./experiments/logs
  checkpoint_dir: ./experiments/checkpoints
  results_dir: ./experiments/results

data:
  dataset: "甘肃光伏功率预测数据集"
  raw_dir: "./datas/2. 甘肃光伏功率预测数据集/data_original/solar_stations"
  merge_method: "single"
  train_ratio: 0.7
  val_ratio: 0.2
  test_ratio: 0.1
  sequence_length: 24
  frequency_minutes: 15
  station_column: station
  timestamp_column: timestamp
  required_columns: [power, irradiance, temperature, pressure, humidity]

walk_forward:
  enable: true
  n_folds: 4
  fold_definition:
    fold1:
      train_months: 12
      val_months: 1
      test_months: 2
    fold2:
      train_months: 15
      val_months: 1
      test_months: 2
    fold3:
      train_months: 18
      val_months: 1
      test_months: 2
    fold4:
      train_months: 21
      val_months: 1
      test_months: 2
  online_learning:
    enable: true
    learning_rate_multiplier: 0.1
    max_updates_per_fold: 100
  weight_inheritance:
    enable: true
    strategy: full

preprocessing:
  caching: true
  cache_dir: ./data/cache
  normalization:
    method: minmax
    feature_range: [0, 1]
  vmd:
    n_modes: 5
    alpha: 2000
    tau: 0.1
    tolerance: 1.0e-6
    max_iterations: 500

feature_engineering:
  ci_thresholds: [0.34075845181405107, 0.4009113122074764]
  wsi_thresholds: [0.7541151075794098, 0.7554378813685727]
  fusion_weights:
    ci: 0.7
    wsi: 0.3
  reuse_cluster_labels:
    enabled: true
    fallback: classify    # classify | drop (当前仅支持 classify)
    min_coverage: 0.95    # 日间覆盖率低于该阈值时发出警告
    splits:
      train:
        labels_path: diagnostics/init_thresholds/init_20251119_235137/cluster_labels.npy
        timestamps_path: diagnostics/init_thresholds/init_20251119_235137/cluster_timestamps.parquet
        meta_path: diagnostics/init_thresholds/init_20251119_235137/cluster_labels_meta.json
      val:
        labels_path: diagnostics/init_thresholds/init_20251120_120224/cluster_labels.npy
        timestamps_path: diagnostics/init_thresholds/init_20251120_120224/cluster_timestamps.parquet
        meta_path: diagnostics/init_thresholds/init_20251120_120224/cluster_labels_meta.json
      test:
        labels_path: diagnostics/init_thresholds/init_20251120_120245/cluster_labels.npy
        timestamps_path: diagnostics/init_thresholds/init_20251120_120245/cluster_timestamps.parquet
        meta_path: diagnostics/init_thresholds/init_20251120_120245/cluster_labels_meta.json
  daytime:
    # 日间掩码：固化为 GHI 法，阈值 5 W/m²（如需改回 GE 可切换 mode 并调整 ge_min_wm2）
    mode: ghi
    ghi_min_wm2: 5.0
    ge_min_wm2: 20.0
    night_handling: exclude
    apply_mask_in_vmd: true
    apply_mask_in_dpsr: true
    apply_mask_in_dlfe: true
  dpsr:
    embedding_dim: 30
    neighborhood_size: 20
    regularization: 0.01
  dlfe:
    target_dim: 30
    sigma: 1.0
    alpha: 0.0009765625
    beta: 0.1
    max_iter: 100
    tol: 1.0e-5
    use_float32_eigh: false
    use_sparse_matrix: true

model:
  # Multi-output dims align with evaluation.horizons
  output_dim: 3
  lstm:
    hidden_sizes: [100, 50]
    dropout_rates: [0.3, 0.2]

training:
  batch_size: 64
  epochs: 100
  learning_rate: 0.01
  optimizer: adamw
  weight_decay: 0.01
  scheduler:
    type: cosine
    eta_min: 1.0e-6
  gradient_accumulation_steps: 4
  num_workers: 4

adaptive:
  error_window: 100
  trigger_thresholds:
    level1: 0.1
    level2: 0.15
    level3: 0.05
    level4: 5

evaluation:
  device: auto
  # Multi-horizon forecasts: 15/30/60 minutes (15 min per step)
  horizons: [1, 2, 4]
  metrics: [RMSE, MAE, NRMSE]
  calculate_confidence: true
  confidence_level: 0.95
  n_bootstrap: 1000
  save_results: true
  generate_report: true
  report_format: markdown
